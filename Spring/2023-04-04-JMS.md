> <span style="font-size: 1.5em">üìñ</span> <span style="color: orange; font-size: 1.3em;">Pr√©sentation `JMS Th√©orie`</span>
> `JEE-SpringII-JMS et ActiveMQ.pptx`

JMS == **Broker de message**


Avant, on utilisait JPA (`Java Persistence API`) (stockage dans une base de donn√©es)
Apr√®s, on utilise JMS (`Java Message Service`) (stockage dans une file d'attente)

JMS est une API pour avoir un dialogue standard entre applications gr√¢ce √† des brokers de messages ou MOM (`Middleware Oriented Message)


![](Screen/2023-04-04-11-11-02.png)

Publish and subscribe (1-Many)
Le message est envoy√© √† un topic (un canal de communication) et tous les abonn√©s re√ßoivent le message. Si aucun abonn√© n'est pr√©sent, le message est perdu.

Point to point (1-1)
Le message est envoy√© √† qu'une seul personne. Si la personne n'est pas pr√©sente, le message est m√©moris√© dans une queue, et quand elle se connecte elle re√ßoit tous les messages qu'elle a manqu√©.
Seul la 1 personne re√ßoit le message, les autres pas (c'est al√©atoire qui re√ßoit).

Les messages sont asynchrones, il n'y a donc pas de "question r√©ponse"

Les donn√©es envoy√©e sont du binaire, il faut donc les s√©rialiser dans le bon format !

# Exercice
https://cyberlearn.hes-so.ch/mod/page/view.php?id=2008832

On d√©marre le docker qui s'occupe de l'ActiveMQ

et on clone les projets de l'exercice (reciver et producer)

## 1 Avoir un reciver
On d√©marre le reciver

et sur le ActiveMQ (du docker) on acc√®de √† cette page :
http://localhost:8161/admin/queues.jsp

![](Screen/2023-04-04-11-48-23.png)

On vois qu'on a 1 personne inscrite sur la queue

On peut envoyer des messages aux utilisateurs connect√©s avec "`Send To`" dans les op√©rations
![](Screen/2023-04-04-11-43-57.png)

![](Screen/2023-04-04-11-51-13.png)

```json
{
 "hello" : "Hey",
 "bonjour" : "Bonsoir ;D"
}
```
Le noms des champs correspondent √† ceux de la classe :

```java
public class HelloWorldMessage {
	
	private String hello;
	
	private String bonjour;
}
```

On remarque que le reciver √† bien re√ßu le message
![](Screen/2023-04-04-11-53-13.png)


## Ex2

Reciver √©coute avec :

```java
@JmsListener // sur une m√©thode
// ==>> Va trigger la m√©thode quand il y aura un message sur la queue
```

Producer √©coute avec : 
```java
@Autowired
JmsTemplate jmsTemplate;

// On envoie un message sur la queue
jmsTemplate.send("txt-q", // Nom de la queue
    messageCreator -> {
        TextMessage message = messageCreator.createTextMessage();
        message.setText("youp-yop"); // Message √† envoyer
        return message;
    });
```	

# Pour le projet

Faire des cas pratique avec √©change "1-1" (reciver-producer dans les 2 sens)

N'est pas un cas pratique : envoy√© "je souhaite les donn√©es" et "je vous envoie les donn√©es" (envoie de la requete sql, puis envoie des donn√©es)

exemple de cas : "je souhaite modifier la donn√©e", "je vous confirme que la donn√©e a √©t√© modifi√©e"